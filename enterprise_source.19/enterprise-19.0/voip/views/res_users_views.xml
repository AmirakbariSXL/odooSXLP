<?xml version="1.0"?>
<odoo>
    <record id="res_user_form" model="ir.ui.view">
        <field name="name">VoIP Config in User Form</field>
        <field name="model">res.users</field>
        <field name="inherit_id" ref="base.view_users_form"/>
        <field name="arch" type="xml">
            <xpath expr="//page[@name='calendar']" position="after">
                <!-- This page is not displayed in the forms of portal users (share = True) in order to avoid confusing
                     administrators with irrelevant settings. -->
                <page string="VoIP" name="voip" invisible="share">
                    <group>
                        <group string="Credentials" name="voip_credentials">
                            <field colspan="2" name="voip_provider_id" options="{'no_open': 1, 'no_create': 1, 'no_edit':1}"/>
                            <button colspan="2" name="%(voip.action_voip_provider_view)d" icon="oi-arrow-right" type="action" string="Manage Providers" class="btn-link"/>
                            <field name="voip_username" readonly="not voip_provider_id"/>
                            <field name="voip_secret" password="True" readonly="not voip_provider_id"/>
                            <button name="%(voip_call_action_history)d" string="View call history" type="action" class="btn btn-secondary btn-sm" icon="fa-phone"/>
                        </group>
                        <group string="Preferences" name="voip_preferences">
                            <field name="should_call_from_another_device" readonly="not voip_provider_id"/>
                            <field name="external_device_number" readonly="not voip_provider_id"/>
                            <field name="how_to_call_on_mobile" widget="radio" readonly="not voip_provider_id"/>
                        </group>
                    </group>
                </page>
            </xpath>
        </field>
    </record>

    <record id="res_users_view_form_preferences" model="ir.ui.view">
        <field name="name">VoIP Config in Preferences Form</field>
        <field name="model">res.users</field>
        <field name="inherit_id" ref="base.view_users_form_simple_modif"/>
        <field name="arch" type="xml">
            <xpath expr="//page[@name='calendar']" position="after">
                <page string="VoIP" name="voip">
                    <group>
                        <group string="Credentials" name="voip_credentials">
                            <field colspan="2" name="voip_provider_id" options="{'no_open': 1, 'no_create': 1, 'no_edit':1}"/>
                            <button colspan="2" name="%(voip.action_voip_provider_view)d" icon="oi-arrow-right" type="action" string="Manage Providers" class="btn-link"/>
                            <field name="voip_username" readonly="not voip_provider_id"/>
                            <field name="voip_secret" password="True" readonly="not voip_provider_id"/>
                            <button name="%(voip_call_action_history)d" string="View call history" type="action" class="btn btn-secondary btn-sm" icon="fa-phone"/>
                        </group>
                        <group string="Preferences" name="voip_preferences">
                            <field name="should_call_from_another_device" readonly="not voip_provider_id"/>
                            <field name="external_device_number" readonly="not voip_provider_id"/>
                            <field name="how_to_call_on_mobile" widget="radio" readonly="not voip_provider_id"/>
                        </group>
                    </group>
                </page>
            </xpath>
        </field>
    </record>
</odoo>
